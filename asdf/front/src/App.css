import React,
{
useState,
useEffect
}

from 'react';

import {
    PieChart,
    Pie,
    Cell,
    ResponsiveContainer,
    BarChart,
    Bar,
    XAxis,
    YAxis,
    CartesianGrid,
    Tooltip as RechartsTooltip,
    Legend,
    ScatterChart,
    Scatter,
    ZAxis,
    ReferenceLine
}

from 'recharts';

import {
    LayoutDashboard,
    Activity,
    BrainCircuit,
    Info,
    ChevronRight,
    TrendingUp,
    AlertTriangle,
    Search,
    MousePointer2,
    Sun,
    Moon,
    Bell,
    User,
    Menu
}

from 'lucide-react';

/**
 * ============================================================================
 * [DATA] 데이터셋 (기존 유지)
 * ============================================================================
 */
const INTEREST_DATA=[ {
    name: '정치/시사', value: 45, color: '#ef4444'
}

,
{
name: '게임', value: 20, color: '#3b82f6'
}

,
{
name: '과학/기술', value: 15, color: '#10b981'
}

,
{
name: '영화/엔터', value: 10, color: '#8b5cf6'
}

,
{
name: '기타', value: 10, color: '#71717a'
}

,
];

const KEYWORDS=[ {
    category: '정치', sub: '대선', action: '이슈 분석', type: 'high'
}

,
{
category: '게임', sub: '마인크래프트', action: '리뷰', type: 'medium'
}

,
{
category: '과학', sub: '물리학', action: '이론 설명', type: 'medium'
}

,
{
category: '경제', sub: '주식', action: '시장 전망', type: 'low'
}

,
];

const COHORT_DATA=[ {
    subject: '정치/시사', user: 85, avg: 30
}

,
{
subject: '게임', user: 40, avg: 45
}

,
{
subject: '과학', user: 35, avg: 10
}

,
{
subject: '뷰티', user: 5, avg: 35
}

,
];

const BIAS_DISTRIBUTION_DATA=[ {
    range: '완전 진보', count: 5
}

,
{
range: '중도 진보', count: 12
}

,
{
range: '중립', count: 8
}

,
{
range: '중도 보수', count: 25
}

,
{
range: '완전 보수', count: 10
}

,
];

const DRIFT_DATA=[ {
    x: 0.1, y: 0.2
}

,
{
x: 0.2, y: 0.35
}

,
{
x: 0.3, y: 0.4
}

,
{
x: 0.4, y: 0.55
}

,
{
x: 0.5, y: 0.7
}

,
{
x: 0.6, y: 0.8
}

,
{
x: 0.65, y: 0.85
}

,
{
x: 0.7, y: 0.9
}

,
{
x: -0.2, y: -0.1
}

,
{
x: 0.0, y: 0.1
}

,
{
x: 0.8, y: 0.95
}

,
{
x: 0.55, y: 0.65
}

];

/**
 * ============================================================================
 * [COMPONENTS] UI Components (Dark/Light Mode Compatible)
 * ============================================================================
 */

// 1. Bento Card: 테마에 따라 스타일 자동 변경
const BentoCard=({
    title, subtitle, children, caption, className="", icon: Icon, isDark

})=>(<div className= {
        ` group relative flex flex-col overflow-hidden rounded-3xl border transition-all duration-300 $ {
            isDark ? 'border-zinc-800 bg-zinc-900/60 backdrop-blur-xl hover:border-zinc-700'
            : 'border-slate-200 bg-white shadow-sm hover:shadow-md hover:border-slate-300'
        }

        $ {
            className
        }

        `
    }

    > {
        /* Dark Mode Glow */
    }

        {
        isDark && (<div className="absolute -right-20 -top-20 h-64 w-64 rounded-full bg-indigo-500/10 blur-3xl transition-all duration-500 group-hover:bg-indigo-500/20" />)
    }

    <div className="relative z-10 flex h-full flex-col p-6" > <div className="mb-6 flex items-start justify-between" > <div> <h3 className= {
        `flex items-center gap-2 text-lg font-bold tracking-tight $ {
            isDark ? 'text-zinc-100' : 'text-slate-800'
        }

        `
    }

    > {
        Icon && <Icon size= {
            18
        }

        className= {
            isDark ? "text-indigo-400" : "text-indigo-600"
        }

        />
    }

        {
        title
    }

    </h3> {
        subtitle && <p className= {
            `mt-1 font-mono text-xs $ {
                isDark ? 'text-zinc-500' : 'text-slate-400'
            }

            `
        }

        > {
            subtitle
        }

        </p>
    }

    </div> </div> <div className="flex-1" > {
        children
    }

    </div> {
        caption && (<div className= {
                `mt-4 flex items-center gap-2 border-t pt-4 text-xs font-medium $ {
                    isDark ? 'border-zinc-800 text-zinc-500' : 'border-slate-100 text-slate-500'
                }

                `
            }

            > <Info size= {
                14
            }

            /> {
                caption
            }

            </div>)
    }

    </div> </div>);

// 2. Custom Tooltip
const CustomTooltip=({
    active, payload, label, isDark

})=> {
    if (active && payload && payload.length) {
        return (<div className= {
                ` rounded-xl border p-3 shadow-xl backdrop-blur-md $ {
                    isDark ? 'border-zinc-700 bg-zinc-950/90 text-zinc-100' : 'border-slate-200 bg-white/95 text-slate-800'
                }

                `
            }

            > <p className="mb-2 font-mono text-xs font-bold opacity-70" > {
                label
            }

            </p> {
                payload.map((entry, index)=> (<div key= {
                            index
                        }

                        className="flex items-center gap-2 text-xs" > <div className="h-1.5 w-1.5 rounded-full" style= {
                                {
                                backgroundColor: entry.color || entry.payload.fill
                            }
                        }

                        /> <span className="opacity-70" > {
                            entry.name
                        }

                        :</span> <span className="font-mono font-bold" > {
                            entry.value
                        }

                        </span> </div>))
            }

            </div>);
    }

    return null;
}

;

// 3. Stat Card (새로운 작은 요약 카드)
const StatCard=({
    title, value, trend, isDark, icon: Icon

})=>(<div className= {
        ` rounded-2xl border p-5 flex items-center justify-between $ {
            isDark ? 'border-zinc-800 bg-zinc-900/40' : 'border-slate-200 bg-white'
        }

        `
    }

    > <div> <p className= {
        `text-xs font-medium mb-1 $ {
            isDark ? 'text-zinc-500' : 'text-slate-500'
        }

        `
    }

    > {
        title
    }

    </p> <div className= {
        `text-2xl font-bold font-mono $ {
            isDark ? 'text-zinc-100' : 'text-slate-900'
        }

        `
    }

    > {
        value
    }

    </div> </div> <div className= {
        `h-10 w-10 rounded-full flex items-center justify-center $ {
            isDark ? 'bg-zinc-800 text-zinc-400' : 'bg-slate-100 text-slate-600'
        }

        `
    }

    > <Icon size= {
        20
    }

    /> </div> </div>);

/**
 * ============================================================================
 * [PAGES]
 * ============================================================================
 */

const InterestPage=({
    isDark

})=> {
    // Chart Colors based on theme
    const axisColor=isDark ? '#71717a': '#94a3b8';
    const gridColor=isDark ? '#27272a': '#e2e8f0';

    return (<div className="space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500" > {
            /* Top Stats Row (New Feature) */
        }

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6" > <StatCard title="Total Videos Analyzed" value="1,240" isDark= {
            isDark
        }

        icon= {
            Activity
        }

        /> <StatCard title="Primary Category" value="Politics" isDark= {
            isDark
        }

        icon= {
            TrendingUp
        }

        /> <StatCard title="Engagement Score" value="Top 5%" isDark= {
            isDark
        }

        icon= {
            User
        }

        /> </div> <div className="grid grid-cols-1 gap-6 md:grid-cols-12" > {
            /* Chart 1: Donut */
        }

        <BentoCard title="관심사 분류" subtitle="TOPIC CLASSIFICATION" className="md:col-span-4 min-h-[350px]" icon= {
            Activity
        }

        isDark= {
            isDark
        }

        > <ResponsiveContainer width="100%" height="100%" > <PieChart> <Pie data= {
            INTEREST_DATA
        }

        cx="50%" cy="50%" innerRadius= {
            60
        }

        outerRadius= {
            80
        }

        paddingAngle= {
            5
        }

        dataKey="value" stroke="none" > {
            INTEREST_DATA.map((entry, index)=> <Cell key= {
                    `cell-$ {
                        index
                    }

                    `
                }

                fill= {
                    entry.color
                }

                />)
        }

        </Pie> <RechartsTooltip content= {
            <CustomTooltip isDark= {
                isDark
            }

            />
        }

        /> <Legend verticalAlign="bottom" height= {
            36
        }

        iconType="circle" wrapperStyle= {
                {
                fontSize: '12px', color: axisColor
            }
        }

        /> </PieChart> </ResponsiveContainer> </BentoCard> {
            /* Chart 2: Cohort */
        }

        <BentoCard title="코호트 비교 분석" subtitle="USER vs AVG COHORT" className="md:col-span-8 min-h-[350px]" icon= {
            TrendingUp
        }

        caption="정치 콘텐츠 소비량 2.8x 높음" isDark= {
            isDark
        }

        > <ResponsiveContainer width="100%" height="100%" > <BarChart data= {
            COHORT_DATA
        }

        margin= {
                {
                top: 20, right: 30, left: 20, bottom: 5
            }
        }

        > <defs> <linearGradient id="userGradient" x1="0" y1="0" x2="0" y2="1" > <stop offset="0%" stopColor="#8b5cf6" stopOpacity= {
            1
        }

        /> <stop offset="100%" stopColor="#6366f1" stopOpacity= {
            0.6
        }

        /> </linearGradient> </defs> <CartesianGrid strokeDasharray="3 3" stroke= {
            gridColor
        }

        vertical= {
            false
        }

        /> <XAxis dataKey="subject" stroke= {
            axisColor
        }

        fontSize= {
            12
        }

        tickLine= {
            false
        }

        axisLine= {
            false
        }

        /> <YAxis stroke= {
            axisColor
        }

        fontSize= {
            12
        }

        tickLine= {
            false
        }

        axisLine= {
            false
        }

        /> <RechartsTooltip cursor= {
                {
                fill: gridColor
            }
        }

        content= {
            <CustomTooltip isDark= {
                isDark
            }

            />
        }

        /> <Bar dataKey="user" fill="url(#userGradient)" radius= {
            [6, 6, 0, 0]
        }

        barSize= {
            40
        }

        /> <Bar dataKey="avg" fill= {
            isDark ? "#3f3f46" : "#cbd5e1"
        }

        radius= {
            [6, 6, 0, 0]
        }

        barSize= {
            40
        }

        /> </BarChart> </ResponsiveContainer> </BentoCard> {
            /* Keywords */
        }

        <BentoCard title="Deep Dive Keywords" subtitle="SEMANTIC HIERARCHY" className="md:col-span-12" icon= {
            Search
        }

        isDark= {
            isDark
        }

        > <div className="flex flex-wrap gap-3 pt-2" > {
            KEYWORDS.map((k, i)=> (<div key= {
                        i
                    }

                    className= {
                        ` flex items-center gap-3 rounded-full border px-5 py-2.5 transition-all $ {
                            isDark ? 'border-zinc-800 bg-zinc-950/50 hover:bg-zinc-900'
                            : 'border-slate-200 bg-slate-50 hover:bg-white'
                        }

                        `
                    }

                    > <span className= {
                        `text-xs font-bold uppercase tracking-wider $ {
                            k.category==='정치' ? 'text-red-500' : k.category==='과학' ? 'text-emerald-500' : 'text-zinc-500'
                        }

                        `
                    }

                    > {
                        k.category
                    }

                    </span> <ChevronRight size= {
                        14
                    }

                    className= {
                        isDark ? "text-zinc-700" : "text-slate-400"
                    }

                    /> <span className= {
                        `text-sm font-medium $ {
                            isDark ? "text-zinc-300" : "text-slate-700"
                        }

                        `
                    }

                    > {
                        k.sub
                    }

                    </span> </div>))
        }

        </div> </BentoCard> </div> </div>);
}

;

const BiasPage=({
    isDark

})=> {
    const currentBiasScore=0.65;
    const biasPercent=((currentBiasScore + 1) / 2) * 100;

    const axisColor=isDark ? '#71717a': '#94a3b8';
    const gridColor=isDark ? '#27272a': '#e2e8f0';

    return (<div className="grid grid-cols-1 gap-6 md:grid-cols-12 animate-in fade-in slide-in-from-bottom-4 duration-500" > {
            /* 1. Main Score Header */
        }

        <div className= {
            ` md:col-span-12 rounded-3xl border p-8 relative overflow-hidden transition-colors duration-300 $ {
                isDark ? 'bg-zinc-900 border-zinc-800'
                : 'bg-white border-slate-200 shadow-sm'
            }

            `
        }

        > {
            isDark && <div className="absolute top-0 right-0 w-96 h-96 bg-red-500/5 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2" />
        }

        <div className="relative z-10 flex flex-col md:flex-row justify-between items-center gap-6" > <div> <h2 className= {
            `text-2xl font-bold flex items-center gap-3 $ {
                isDark ? 'text-zinc-100' : 'text-slate-900'
            }

            `
        }

        > <BrainCircuit className="text-red-500" /> Political Bias Diagnosis </h2> <p className= {
            `mt-2 max-w-xl $ {
                isDark ? 'text-zinc-400' : 'text-slate-500'
            }

            `
        }

        > 벡터 임베딩 분석 결과, 사용자의 시청 패턴은 <span className="text-red-500 font-bold mx-1" >중도 보수 (Moderate Conservative)</span> 성향이 짙습니다. </p> </div> <div className="text-right" > <div className= {
            `text-5xl font-mono font-bold tracking-tighter $ {
                isDark ? 'text-white' : 'text-slate-900'
            }

            `
        }

        > + {
            currentBiasScore
        }

        </div> <div className="text-xs font-mono text-zinc-500 uppercase mt-1" >Bias Vector Score</div> </div> </div> {
            /* Gauge Bar */
        }

        <div className= {
            `mt-8 relative h-4 w-full rounded-full overflow-hidden $ {
                isDark ? 'bg-zinc-800' : 'bg-slate-100'
            }

            `
        }

        > <div className="absolute inset-0 bg-gradient-to-r from-blue-500 via-slate-400 to-red-500 opacity-80" /> <div className="absolute top-0 bottom-0 w-1.5 bg-white shadow-lg transition-all duration-1000 z-10"

        style= {
                {
                left: `$ {
                    biasPercent
                }

                %`
            }
        }

        /> </div> <div className="mt-2 flex justify-between text-xs font-mono text-zinc-500" > <span>Liberal (-1.0)</span> <span>Conservative (+1.0)</span> </div> </div> {
            /* 2. Drift Analysis */
        }

        <BentoCard title="알고리즘 확증 편향 (Bias Drift)" subtitle="VECTOR SPACE MAPPING" className="md:col-span-8 min-h-[400px]" icon= {
            MousePointer2
        }

        isDark= {
            isDark
        }

        > <ResponsiveContainer width="100%" height="100%" > <ScatterChart margin= {
                {
                top: 20, right: 20, bottom: 20, left: 0
            }
        }

        > <CartesianGrid strokeDasharray="3 3" stroke= {
            gridColor
        }

        /> <XAxis type="number" dataKey="x" name="Watch" domain= {
            [-1, 1]
        }

        stroke= {
            axisColor
        }

        fontSize= {
            10
        }

        tickCount= {
            7
        }

        /> <YAxis type="number" dataKey="y" name="Recommend" domain= {
            [-1, 1]
        }

        stroke= {
            axisColor
        }

        fontSize= {
            10
        }

        tickCount= {
            7
        }

        /> <ZAxis type="number" range= {
            [100, 300]
        }

        /> <RechartsTooltip cursor= {
                {
                strokeDasharray: '3 3'
            }
        }

        content= {
            <CustomTooltip isDark= {
                isDark
            }

            />
        }

        /> <ReferenceLine segment= {
            [ {
                x: -1, y: -1
            }

            , {
            x: 1, y: 1
        }

        ]
    }

    stroke= {
        axisColor
    }

    strokeDasharray="5 5" /> <Scatter name="Vectors" data= {
        DRIFT_DATA
    }

    fill="#8b5cf6" > {
        DRIFT_DATA.map((entry, index)=> (<Cell key= {
                    `cell-$ {
                        index
                    }

                    `
                }

                fill= {
                    entry.y > entry.x ? '#ef4444' : '#8b5cf6'
                }

                fillOpacity= {
                    0.7
                }

                />))
    }

    </Scatter> </ScatterChart> </ResponsiveContainer> </BentoCard> {
        /* 3. Distribution */
    }

    <BentoCard title="추천 분포도" subtitle="RECOMMENDATION HISTOGRAM" className="md:col-span-4" icon= {
        Activity
    }

    isDark= {
        isDark
    }

    > <div className="flex h-full flex-col justify-between" > <ResponsiveContainer width="100%" height= {
        200
    }

    > <BarChart data= {
        BIAS_DISTRIBUTION_DATA
    }

    > <defs> <linearGradient id="distBar" x1="0" y1="0" x2="0" y2="1" > <stop offset="0%" stopColor="#94a3b8" stopOpacity= {
        0.8
    }

    /> <stop offset="100%" stopColor="#475569" stopOpacity= {
        0.4
    }

    /> </linearGradient> </defs> <XAxis dataKey="range" hide /> <RechartsTooltip content= {
        <CustomTooltip isDark= {
            isDark
        }

        />
    }

    cursor= {
            {
            fill: 'transparent'
        }
    }

    /> <Bar dataKey="count" fill="url(#distBar)" radius= {
        [4, 4, 4, 4]
    }

    /> </BarChart> </ResponsiveContainer> <div className= {
        `mt-4 rounded-xl border p-4 $ {
            isDark ? 'border-red-500/20 bg-red-500/10' : 'border-red-200 bg-red-50'
        }

        `
    }

    > <div className="flex items-start gap-3" > <AlertTriangle className= {
        `shrink-0 $ {
            isDark ? 'text-red-400' : 'text-red-500'
        }

        `
    }

    size= {
        20
    }

    /> <div> <h4 className= {
        `text-sm font-bold $ {
            isDark ? 'text-red-200' : 'text-red-700'
        }

        `
    }

    >Filter Bubble Risk</h4> <p className= {
        `mt-1 text-xs leading-relaxed $ {
            isDark ? 'text-red-200/60' : 'text-red-600/80'
        }

        `
    }

    > 알고리즘이 편향된 영상을 지속적으로 공급하고 있습니다. </p> </div> </div> </div> </div> </BentoCard> </div>);
}

;

/**
 * ============================================================================
 * [LAYOUT & APP]
 * ============================================================================
 */
const App=()=> {
    const [currentPage,
    setCurrentPage]=useState('interest');
    const [isDarkMode,
    setIsDarkMode]=useState(true); // 테마 상태 관리

    return ( // 최상위 래퍼에서 배경색 제어

        <div className= {
            `flex min-h-screen font-sans transition-colors duration-300 $ {
                isDarkMode ? 'bg-[#09090b] text-zinc-100' : 'bg-slate-50 text-slate-900'
            }

            `
        }

        > {
            /* 1. Sidebar */
        }

        <aside className= {
            ` fixed left-0 top-0 hidden h-full w-64 flex-col border-r p-6 transition-all duration-300 md:flex z-50 $ {
                isDarkMode ? 'border-zinc-800 bg-zinc-950/50 backdrop-blur-xl' : 'border-slate-200 bg-white'
            }

            `
        }

        > <div className="mb-10 flex items-center gap-3 px-2" > <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-indigo-600 shadow-lg shadow-indigo-500/30" > <Activity className="text-white" size= {
            16
        }

        /> </div> <span className= {
            `text-lg font-bold tracking-tight $ {
                isDarkMode ? 'text-white' : 'text-slate-900'
            }

            `
        }

        > Algo.Analysis </span> </div> <nav className="space-y-1" > {
            [ {
                id: 'interest', label: 'Interest Profiling', icon: LayoutDashboard
            }

            ,
            {
            id: 'bias', label: 'Bias Diagnosis', icon: BrainCircuit
        }

        ,
        ].map((item)=> (<button key= {
                    item.id
                }

                onClick= {
                    ()=> setCurrentPage(item.id)
                }

                className= {
                    `group flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-all $ {
                        currentPage===item.id ? (isDarkMode ? 'bg-zinc-800 text-white' : 'bg-slate-100 text-indigo-700') : (isDarkMode ? 'text-zinc-500 hover:bg-zinc-900 hover:text-zinc-200' : 'text-slate-500 hover:bg-slate-50 hover:text-slate-900')
                    }

                    `
                }

                > <item.icon size= {
                    18
                }

                className= {
                    currentPage===item.id ? (isDarkMode ? 'text-indigo-400' : 'text-indigo-600') : 'opacity-70'
                }

                /> {
                    item.label
                }

                </button>))
    }

    </nav> <div className="mt-auto" > <div className= {
        `rounded-xl p-4 $ {
            isDarkMode ? 'bg-zinc-900' : 'bg-slate-100'
        }

        `
    }

    > <div className="flex items-center gap-2 text-xs font-medium text-emerald-500" > <span className="relative flex h-2 w-2" > <span className="absolute inline-flex h-full w-full animate-ping rounded-full bg-emerald-400 opacity-75" ></span> <span className="relative inline-flex h-2 w-2 rounded-full bg-emerald-500" ></span> </span> System Operational </div> </div> </div> </aside> {
        /* 2. Main Content Wrapper */
    }

    <div className="flex-1 md:ml-64 flex flex-col" > {
        /* 2.1 Top Header (새로운 기능: 네비게이션 + 테마 토글) */
    }

    <header className= {
        ` sticky top-0 z-40 flex h-16 items-center justify-between border-b px-8 backdrop-blur-md transition-colors duration-300 $ {
            isDarkMode ? 'border-zinc-800 bg-zinc-950/80' : 'border-slate-200 bg-white/80'
        }

        `
    }

    > <div className="flex items-center gap-4" > <h2 className= {
        `text-sm font-medium $ {
            isDarkMode ? 'text-zinc-400' : 'text-slate-500'
        }

        `
    }

    > Dashboard / <span className= {
        isDarkMode ? 'text-zinc-100' : 'text-slate-900'
    }

    > {
        currentPage==='interest' ? 'Overview' : 'Bias Check'
    }

    </span> </h2> </div> <div className="flex items-center gap-3" > {
        /* Theme Toggle Button */
    }

    <button onClick= {
        ()=> setIsDarkMode( !isDarkMode)
    }

    className= {
        `rounded-full p-2 transition-colors $ {
            isDarkMode ? 'bg-zinc-800 text-yellow-400 hover:bg-zinc-700' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
        }

        `
    }

    > {
        isDarkMode ? <Sun size= {
            18
        }

        /> : <Moon size= {
            18
        }

        />
    }

    </button> <button className= {
        `rounded-full p-2 transition-colors $ {
            isDarkMode ? 'hover:bg-zinc-800 text-zinc-400' : 'hover:bg-slate-100 text-slate-500'
        }

        `
    }

    > <Bell size= {
        18
    }

    /> </button> <div className= {
        `h-8 w-8 rounded-full flex items-center justify-center border $ {
            isDarkMode ? 'bg-indigo-500/20 border-indigo-500/50 text-indigo-400' : 'bg-indigo-100 border-indigo-200 text-indigo-600'
        }

        `
    }

    > <span className="text-xs font-bold" >R</span> </div> </div> </header> {
        /* 2.2 Dashboard Content */
    }

    <main className="flex-1 p-8" > <div className="mb-8" > <h1 className= {
        `text-3xl font-bold tracking-tight $ {
            isDarkMode ? 'text-white' : 'text-slate-900'
        }

        `
    }

    > {
        currentPage==='interest' ? 'User Profiling' : 'Bias Diagnosis'
    }

    </h1> <p className= {
        `mt-2 $ {
            isDarkMode ? 'text-zinc-400' : 'text-slate-500'
        }

        `
    }

    > {
        currentPage==='interest' ? 'AI 기반 시청 기록 분석 리포트' : '알고리즘 확증편향 심층 진단'
    }

    </p> </div> {
        currentPage==='interest' ? <InterestPage isDark= {
            isDarkMode
        }

        /> : <BiasPage isDark= {
            isDarkMode
        }

        />
    }

    </main> </div> </div>);
}

;

export default App;